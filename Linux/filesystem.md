### 根目录下各目录用途
- /bin：必要的可执行程序，包括各种最基本的命令如ls  
- /sbin：只有root可以运行的系统可执行程序  
- /boot：内核启动的加载文件  
- /dev：系统所使用的各种设备，如鼠标、键盘、磁盘等  
- /lib：/bin中的可执行程序需要用的二进制文件  
- /media：作为可移除媒体设备的接入点，如U盘等  
- /usr：用户安装软件和utilities的地方 

<br/>

### VFS: Virtual FIle System
&emsp;&emsp;现在绝大部分的Linux发行版中，VFS抽象层都是一个核心组件，它提供了一个统一的接口，用于访问不同文件系统的文件和目录，实现了文件系统的抽象和管理    
1. 统一接口：VFS层提供了一个统一的文件系统接口，使得上层应用程序可以使用相同的系统调用和函数来操作不同类型的文件系统。这简化了应用程序的开发，无需关注底层文件系统的差异性。  
2. 可移植性：通过VFS层，应用程序可以在不同的操作系统上运行，无论底层文件系统的类型如何。这种可移植性使得开发人员可以更容易地将应用程序移植到不同的平台和发行版上。  
3. 多文件系统支持：VFS层使得Linux能够支持多种不同的文件系统，如ext4、FAT、NTFS、NFS等。这使得用户可以选择适合他们需求的文件系统类型，并在同一系统中同时使用多个文件系统。  
4. 灵活性和可扩展性：VFS层的设计使得新增文件系统变得相对容易。通过实现一组标准的操作函数，开发人员可以将新的文件系统类型集成到Linux中，而不会对现有的应用程序和系统产生太大影响。  

<br/>

### 日志技术：journaling
&emsp;&emsp;文在传统的文件系统中，当进行写操作时，数据会直接写入文件系统的数据结构中，例如文件的数据块。这意味着如果在写操作过程中系统崩溃，可能会导致数据损坏或不一致。

&emsp;&emsp;而具有日志功能的文件系统，如ext3、ext4和XFS，会在执行写操作之前，先将操作写入一个称为日志（journal）的特殊区域中。该日志会记录文件系统即将执行的操作，包括文件的创建、删除、重命名等。一旦操作被记录在日志中，文件系统就会认为该操作已经完成。

&emsp;&emsp;在文件系统执行写操作后，会将操作的结果同步地写入文件系统的实际数据结构中。当这些操作成功完成后，文件系统会将日志中的相应条目标记为完成。

&emsp;&emsp;当系统遇到异常情况导致文件系统崩溃时，下次系统启动时，文件系统会首先检查日志中未完成的操作。通过读取日志，文件系统可以确定哪些操作已经完成，哪些操作尚未完成。然后，它可以根据日志中的信息，将文件系统恢复到一致的状态，即完成未完成的操作或撤销已完成的操作。这样可以避免数据损坏和不一致的问题。

日志文件系统的使用带来以下好处：

1. 数据一致性：日志文件系统确保在系统异常情况下，如断电或崩溃，文件系统可以快速恢复并保持一致性，避免数据损坏或不一致的问题。

2. 快速恢复：由于只需要恢复日志中未完成的操作，而不是整个文件系统，所以日志文件系统的恢复速度较快。

3. 高可靠性：通过日志记录每个操作，可以提供更高的可靠性，减少数据丢失的风险。

总而言之，文件系统中的日志功能提供了一种机制，确保在异常情况下文件系统的一致性和可靠性，是现代文件系统中的重要特性之一。包括Linux的ext4（第四代扩展文件系统）和Windows的NTFS都是日志文件系统。  

<br/>

### 分区
&emsp;&emsp;分区是对磁盘进行的操作，目的是把一整张磁盘划分成多个部分，不同的部分可以采用不同的文件系统，用于容纳不同的文件，这样可以更加高效地利用磁盘空间和组织磁盘文件

&emsp;&emsp;分区方法主要有两种，两种方法在实际系统中主要体现为分区表的结构不同，分区表是一个数据结构，每个磁盘都有一个分区表，用于记录磁盘是如何分区的、每个分区在磁盘上的起始位置和大小、启动引导文件的位置等。
1. MBR：老主流标准
&emsp;&emsp;分区有三种类型：主分区、扩展分区、逻辑分区。它限制了主分区数目最多有四个，如果想要划分更多的分区，需要把一个主分区转换成为扩展分区（扩展分区只能有一个），然后再在扩展分区中划分多个逻辑分区。  
2. GPT：新主流标准
&emsp;&emsp;分区只有一种主分区，每个分区由一个独一无二的GUID用于标识，且最多支持128个分区，可以支持更大的容量。

<br/>

### 文件系统结构
1. Boot block（引导块）：  
&emsp;&emsp;它位于文件系统的起始扇区，不是由文件系统本身使用。引导块包含了引导操作系统所需的信息，通常是操作系统启动程序的一部分。引导块的主要作用是在计算机启动时加载操作系统，并将控制权转移到操作系统的引导代码。一块磁盘中可能有许多引导块，但只有一个被使用。  
2. Super block（超级块）：  
&emsp;&emsp;引导块之后是超级快。超级块是文件系统中的一个重要数据结构，存储了有关文件系统的元数据信息。超级块中的内容包括文件系统的大小、块大小、inode表的大小和位置、数据块的大小和位置，以及其他文件系统特定的参数。超级块提供了文件系统的整体描述和配置信息，操作系统和文件系统工具可以使用这些信息来管理和操作文件系统。
3. Inode table（索引节点表）：  
&emsp;&emsp;索引节点表是文件系统的关键组成部分，用于管理文件和目录。每个文件或目录在索引节点表中都有一个唯一的索引节点（inode）条目。索引节点存储了与文件相关的元数据信息，如文件的权限、所有者、创建时间、修改时间、文件大小以及指向文件数据块的指针等。索引节点表提供了文件系统中文件的索引和位置信息，操作系统通过索引节点可以查找和管理文件。
4. Data blocks（数据块）：  
&emsp;&emsp;数据块是实际存储文件内容和目录结构的部分。数据块是分配给文件和目录的存储空间，用于存储它们的实际数据。文件系统将文件的内容分割成多个数据块，并使用数据块的指针来记录它们的位置和顺序。目录结构也使用数据块来存储目录的文件名和指向文件的指针。数据块的大小通常是文件系统的一个重要参数，并且根据文件系统的设计和优化策略而有所不同。

&emsp;&emsp;这些组成部分共同构成了文件系统的结构，并协同工作以支持文件和目录的管理和存储。引导块负责启动操作系统，超级块提供文件系统的整体描述，索引节点表存储文件的元数据，而数据块存储文件和目录的实际数据。这种组织结构允许操作系统和用户访问和操作文件系统中的文件和目录。

<br/>

### 整体流程
1. 首先是使用分区工具工具对磁盘进行分区，这时要选择使用的分区表类型，即选择分区的方法是MBR还是GPT，常用的分区工具有parted和gdisk。这一步主要要确定每个分区的起始位置和大小。  
2. 然后需要在每个分区创建文件系统，常用工具是mkfs（make file system）。这时会指定每个文件系统的类型。  
3. 之后需要把文件系统/分区挂载到系统中，只有挂载到系统之后，才能访问文件系统及其中的数据。常用mount和unmount命令。  
4. 如果需要让某些分区/文件系统在每次启动时都自动挂载，那么需要修改/etc/fstab文件（filesystem table）。这个文件中存放的是启动时要挂载的文件系统的信息，包括文件系统设备、挂载点、文件系统类型等信息。这个文件的修改需要尤其注意！

<br/>

注：
1. 关于文件系统和磁盘的一些常用命令参见OneNote笔记，记得很全面，不过有个别命令记得不是很详细。
2. 关于这一块的系统教程：https://linuxjourney.com/lesson/filesystem-hierarchy  
3. chatGPT conversation：Disk and Filesystem
