## 语义鸿沟

“语义鸿沟”在 RAG（检索增强生成）系统中指的是**用户提问的语义与被检索到的文档中所包含的关键信息之间存在的不匹配或不一致**。这种鸿沟主要源于以下几个方面：

### 1. 什么是语义鸿沟？

- **定义**：
  语义鸿沟描述的是用户问题的深层语义与检索模块（如向量检索或关键词检索）提取出的文档内容之间的差距。简单来说，就是用户真正想表达的含义与系统检索到的文本在语义上存在偏差或缺失。
- **产生原因**：
  - **表示不足**：检索系统通常将文本转化为向量或符号表示，但这种表示可能无法捕捉全部细节或特定领域的精确信息。
  - **语义模糊**：用户提问可能使用了模糊或多义的词汇，而系统难以准确匹配。
  - **检索算法局限**：纯向量或关键词搜索在处理复杂语义时容易漏掉一些关键的上下文信息。

------

### 2. 语义鸿沟会造成什么问题？

- **召回率低**：
  当语义鸿沟存在时，系统可能无法检索到所有真正相关的文档，导致相关信息漏检，进而影响回答的全面性和准确性。
- **生成错误或不完整答案**：
  如果生成模型基于不完整或偏离用户真实需求的上下文进行回答，就可能产生错误信息、遗漏细节或“胡编乱造”的现象（即模型“幻觉”）。
- **用户体验下降**：
  用户期待系统能够理解并回答其问题，但语义鸿沟会使得系统输出的答案与用户期望有较大偏差，降低信任度。

------

### 3. 解决方案

#### 3.1 改进检索模块

- **更精确的语义编码器**：
  对查询和文档进行更细致的向量化，使用更先进的预训练模型或领域特定的微调模型，使得语义表示更加精准。
- **混合搜索**：
  结合关键词检索（如 BM25、TF-IDF）与向量搜索，利用关键词的精确匹配来补充向量检索可能丢失的关键信息。
- **多阶段检索与重排序**：
  首先用宽松的向量检索召回候选文档，再用交叉编码器（cross-encoder）或大模型对候选文档进行重排序，从而提高最终的召回率和准确性。

#### 3.2 引入结构化知识

- **知识图谱和图数据库**：
  利用图结构存储实体和关系，提供更加结构化和语义明确的检索结果。GraphRAG 就是这方面的一个探索，通过构建知识图谱来弥合语义鸿沟。
- **文档结构化预处理**：
  对非结构化文档（如 PDF、PPT）进行 OCR、布局解析等预处理，提取出关键信息并形成结构化数据，提高检索的准确度。

#### 3.3 生成阶段增强

- **交叉重排序（Cross-Encoder Re-ranking）**：
  将候选文档与查询一起输入大模型，通过链式思考（CoT）或多轮交互来对文档的相关性进行打分与重排序，进一步弥合语义鸿沟。
- **任务分解与代理（Agentic RAG）**：
  通过将复杂问题拆分为多个子任务，分别进行检索和生成，再整合回答，降低单步检索中因语义鸿沟带来的信息遗漏风险。

------

### 4. 为什么语义鸿沟这个问题很重要？

- **核心影响生成质量**：
  RAG 系统的效果依赖于检索模块提供的上下文。如果上下文中缺少关键语义信息，生成模型即使很强也无法弥补，答案就可能不准确或不完整。
- **决定系统鲁棒性**：
  在实际应用中，用户提问往往多样且复杂，如何准确匹配用户意图与知识库中的信息是系统能否稳定、可靠地回答问题的关键。
- **提高用户体验和信任度**：
  弥合语义鸿沟能够显著提高回答的准确性和全面性，直接提升用户体验，使系统在商业、企业知识管理、客服等场景中更具实用价值。
- **推动 RAG 技术进步**：
  语义鸿沟问题是 RAG 系统目前面临的主要挑战之一。解决这一问题有助于构建更智能、灵活、准确的问答系统，从而推动整个领域的技术进步。

### 总结：

**语义鸿沟**是指用户查询的深层语义与检索结果中包含的信息之间的不匹配，这一问题会导致检索召回不足和生成错误答案。解决方案包括改进语义编码、采用混合检索、利用知识图谱、进行多阶段重排序以及任务分解等。该问题的重要性在于它直接影响 RAG 系统的准确性、鲁棒性和用户体验，是提升检索增强生成系统整体性能的关键瓶颈。



## RAPTOR

RAPTOR（Recursive Abstraction and Tree-based Organization for Retrieval）是一种旨在解决检索增强生成（RAG）中语义鸿沟问题的技术方案。其核心思想是通过构建递归的树形结构，对文档进行多层次的语义聚类与摘要，以提升检索性能。

**RAPTOR 的工作原理：**

1. **文本分块与嵌入：** 将长文本按一定长度（如100个词）进行分块，对每个块生成嵌入表示。
2. **递归构建树结构：** 将相似的文本块聚类，生成摘要及其嵌入，作为树的父节点。重复此过程，形成多层次的树结构，每层节点表示不同粒度的语义信息。
3. **检索过程：** 对于查询，采用树遍历或全树评估策略，定位最相关的节点，确保检索结果的准确性和效率。

**RAPTOR 的优势：**

- **多层次语义表示：** 通过树形结构，捕捉不同层次的语义信息，提升对复杂查询的处理能力。
- **高效检索：** 利用树结构优化检索路径，减少计算开销，提高检索速度。

综上，RAPTOR 通过递归摘要与树形检索的结合，增强了 RAG 系统的语义理解和检索能力，有效缓解了传统方法中的语义鸿沟问题。

![image-20250305210825763](C:\Users\10133\AppData\Roaming\Typora\typora-user-images\image-20250305210825763.png)

### 核心概念：摘要

在 **RAPTOR** 方案中，**摘要（Abstraction）** 指的是对原始文本内容进行压缩表达，使其在保持核心信息的同时，减少冗余内容。这个摘要通常由大模型（LLM）生成，可以是：

- **句子级别摘要**：保留文本的核心句子。
- **段落级别摘要**：提取段落的关键信息。
- **层级摘要**：在树的不同层次上，低层摘要更详细，高层摘要更概括。

**为什么需要摘要？**
RAG 依赖于检索文档，但原始文档可能过长，直接存储所有文本进行向量搜索会导致 **召回率低**、**计算开销大**，并且检索回来的片段可能包含大量无关信息。RAPTOR 通过 **构建摘要层级结构**，让查询时可以在更紧凑的信息范围内进行匹配，提高查询效率。

**RAPTOR 如何使用摘要？**

1. **底层文本块** 仍然是原始文本，按固定长度分割。
2. **中间层摘要** 通过 LLM 归纳多个块的核心内容，使得同类信息被概括在一起。
3. **顶层摘要** 则是整篇文档或多个文档的总结，捕捉更广泛的主题。

这样，在查询时，可以先匹配高层摘要，缩小搜索范围，再深入匹配底层详细内容，提高检索效率和相关性。



## SiReRAG

SiReRAG（**Si**milarity and **Re**latedness-based Retrieval-Augmented Generation）是在RAPTOR基础上发展而来的，旨在解决RAG（检索增强生成）系统中存在的语义鸿沟问题，特别是针对需要多跳推理的复杂查询。

**SiReRAG的核心创新：**

1. **相似性索引：**
   - 与RAPTOR类似，SiReRAG通过递归摘要构建相似性树，对语义相似的文本块进行组织。
2. **关联性索引：**
   - SiReRAG从文本中提取**命名实体**和**命题**，将共享实体的命题聚合，形成关联性树。
   - 通过递归摘要，构建高层次节点，提升推理效率。
3. **混合召回机制：**
   - 在检索过程中，SiReRAG结合相似性和关联性索引，提供多粒度的混合召回，包括实体、实体组和原始文本。
   - 这种方法增强了对数据的宏观理解，提高了模糊意图和多跳查询场景下的召回效果。

**与RAPTOR的区别：**

- **RAPTOR：**
  - 主要基于语义相似性，通过递归摘要构建相似性树。
  - 在处理多跳推理时可能存在不足。
- **SiReRAG：**
  - 在相似性索引基础上，增加了关联性索引。
  - 通过结合相似性和关联性，提升了对复杂查询的处理能力。

在SiReRAG的框架中，**命名实体（Named Entity）** 和 **命题（Proposition）** 是用于构建**关联性索引**的两个关键概念。

------

### **1. 命名实体（Named Entity）**

命名实体是指**特定类别的重要名词**，例如：

- **人名**（如“爱因斯坦”）
- **地名**（如“北京”）
- **组织名**（如“Google”）
- **日期**（如“2024年3月”）
- **专业术语**（如“量子计算”）

在SiReRAG中，提取命名实体是为了**发现文本中的关键概念，并在相关文档之间建立联系**。例如：

- **文章 A**：爱因斯坦提出了相对论。
- **文章 B**：相对论影响了现代物理学。

在传统的RAG中，如果只用向量相似度搜索，它可能无法识别这两篇文章的相关性。但SiReRAG会识别“爱因斯坦”和“相对论”作为命名实体，并将其作为连接点，把相关文档关联在一起。

------

### **2. 命题（Proposition）**

**命题是比单个实体更复杂的结构，它代表一个陈述句或事实。**其中通常包含命名实体（主语、宾语）和实体之间的关系（谓语）

- 例如：
  - **“爱因斯坦提出相对论”**
  - **“黑洞会发射霍金辐射”**
  - **“量子计算比经典计算更快”**

这些命题通常包含：

- **主体（subject）**：爱因斯坦
- **谓语（predicate）**：提出
- **宾语（object）**：相对论

SiReRAG会**提取这些命题，并根据共享实体进行关联**，形成一个语义网络（类似于图数据库中节点与节点之间通过关系连接成一个图）。例如：

- 命题 1：**“爱因斯坦提出相对论”**
- 命题 2：**“相对论影响了现代物理”**
- 命题 3：**“现代物理研究黑洞”**

这些命题都围绕“相对论”展开，因此可以建立相关性索引，让检索系统更容易找到真正有用的信息。

![img](https://pic1.zhimg.com/v2-8618a847b98adfd65cf3f45e5b931b24_1440w.jpg)

------

### **3. 摘要 vs. 命名实体 & 命题**

| **概念**                     | **作用**                           | **示例**                                       |
| ---------------------------- | ---------------------------------- | ---------------------------------------------- |
| **摘要（Summarization）**    | 生成文本的简要版本，保留关键信息   | **“爱因斯坦提出了相对论，它影响了现代物理。”** |
| **命名实体（Named Entity）** | 识别出文本中的重要概念或专有名词   | **“爱因斯坦”、“相对论”**                       |
| **命题（Proposition）**      | 从文本中提取可用于推理的事实或陈述 | **“爱因斯坦提出相对论”**                       |

在SiReRAG中：

- **摘要用于构建相似性索引**（Semantic Indexing），帮助RAG理解文本的主要内容。
- **命名实体和命题用于构建关联性索引**（Relational Indexing），让系统能够基于语义关联找到相关信息。

------

### **4. 这些概念为什么重要？**

在传统RAG中，检索主要依赖于向量搜索（Semantic Similarity）。但**向量相似度不能很好地处理逻辑推理或多跳查询**，比如：

- 用户问：“相对论如何影响黑洞研究？”
- 传统RAG可能找不到合适的文档，因为“相对论”与“黑洞”在表述上相差较远。

SiReRAG通过命名实体和命题索引，可以发现：

1. “爱因斯坦提出相对论” → “相对论影响现代物理” → “黑洞研究是现代物理的一部分”
2. 这样可以引导检索到更相关的内容，解决**语义鸿沟（Semantic Gap）**。

------

### **总结**

- **命名实体** 提取文本中的关键概念（人名、地名、组织等）。
- **命题** 提取事实性陈述（谁做了什么）。
- **摘要** 是对文本整体内容的高度概括。
- **SiReRAG 结合这三者**，既能通过摘要进行语义匹配，又能通过实体和命题建立逻辑关联，提高RAG的检索能力。